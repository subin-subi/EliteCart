<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orders | Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Smooth transition for sidebar */
    .sidebar {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>

<body class="bg-black text-white flex flex-col min-h-screen">

  <!-- Top Navbar (for small screens) -->
  <header class="bg-zinc-900 px-5 py-4 flex justify-between items-center md:hidden">
    <h1 class="font-bold text-xl tracking-wide">ELITECART</h1>
    <button id="menuBtn" class="text-white focus:outline-none">
      <span class="material-icons text-3xl">menu</span>
    </button>
  </header>

 <div class="flex flex-1">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed md:static top-0 left-0 w-60 h-full bg-zinc-900 p-5 shadow-lg transform -translate-x-full md:translate-x-0 z-50">
    <%- include('../partials/sidebar') %>
  </aside>

  <!-- Overlay for mobile -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden md:hidden z-40"></div>

  <!-- Main Content -->
  <main class="flex-1 p-3 md:ml-10 transition-all duration-300 md:px-3 md:py-2">

    <div class="bg-neutral-900 rounded-2xl p-5 shadow-lg border border-gray-800">
      <!-- Header -->
      <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4">
        <h2 class="text-2xl font-bold text-white">Orders</h2>
        <div class="relative w-full sm:w-72">
          <input 
            type="text" 
            placeholder="🔍 Search" 
            class="w-full px-4 py-2 rounded-lg bg-gray-800 text-gray-300 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-green-400"
          />
        </div>
      </div>

      <!-- Orders Table -->
      <div class="overflow-x-auto rounded-lg border border-gray-700">
        <table class="min-w-full text-sm text-left">
          <thead class="bg-gray-800 text-gray-300 uppercase text-xs">
            <tr>
              <th class="px-6 py-4 font-semibold">ID</th>
              <th class="px-6 py-4 font-semibold">Name</th>
              <th class="px-6 py-4 font-semibold">Payment</th>
              <th class="px-6 py-4 font-semibold">Status</th>
              <th class="px-6 py-4 font-semibold">Price</th>
              <th class="px-6 py-4 text-center font-semibold">Action</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700">
            <% orders.forEach((order, index) => { %>
              <tr class="hover:bg-gray-800 transition">
                <td class="px-6 py-4">#<%= index + 1 %></td>
                <td class="px-6 py-4"><%= order.userId?.name || "Unknown" %></td>
                <td class="px-6 py-4"><%= order.paymentMethod %></td>
                <td class="px-6 py-4">
                  <% if (order.status === "Delivered") { %>
                    <span class="text-green-400 font-semibold">Delivered</span>
                  <% } else if (order.status === "Cancelled") { %>
                    <span class="text-red-500 font-semibold">Cancelled</span>
                  <% } else if (order.status === "Processing") { %>
                    <span class="text-yellow-400 font-semibold">Processing</span>
                  <% } else { %>
                    <span class="text-gray-400"><%= order.status %></span>
                  <% } %>
                </td>
                <td class="px-6 py-4 font-medium">₹<%= order.grandTotal ? order.grandTotal.toFixed(2) : '0.00' %></td>
                <td class="px-6 py-4 text-center">
                  <button 
                    onclick="openOrderModal('<%= order._id %>')" 
                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold text-xs sm:text-sm transition shadow-md hover:shadow-lg">
                    More Details
                  </button>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>

<!-- //////////////////////////////////////////////////// Modal ///////////////////////////////////////////// -->
<div id="orderModal" class="fixed inset-0 bg-black bg-opacity-60 hidden justify-center items-center z-50">
  <div class="bg-neutral-900 border border-gray-700 rounded-2xl shadow-2xl p-6 w-full max-w-4xl relative">

    <!-- Close Button -->
    <button 
      onclick="closeOrderModal()"
      class="absolute top-3 right-3 bg-red-600 hover:bg-red-700 text-white rounded-full px-3 py-1 text-sm font-semibold">
      ✕
    </button>

    <!-- Header -->
    <h2 class="text-xl font-bold mb-5 border border-blue-500 rounded-md px-4 py-2 inline-block">Order Details</h2>

    <div id="orderModalContent" class="text-white space-y-3">
      <p>Loading order details...</p>
    </div>
  </div>
</div>




<!-- ////////////////////////pagination////////////////////////////////////////////// -->
 
        <!-- Pagination -->
        <div class="flex flex-wrap justify-center items-center mt-6 gap-2">
          <% if (currentPage > 1) { %>
            <a href="?page=<%= currentPage - 1 %>" class="bg-gray-800 text-gray-300 px-4 py-2 rounded-md hover:bg-gray-700 transition">Previous</a>
          <% } %>

          <% for (let i = 1; i <= totalPages; i++) { %>
            <a 
              href="?page=<%= i %>" 
              class="px-4 py-2 rounded-md <%= currentPage === i ? 'bg-white text-black' : 'bg-gray-800 text-gray-300 hover:bg-gray-700' %> transition"
            >
              <%= i %>
            </a>
          <% } %>

          <% if (currentPage < totalPages) { %>
            <a href="?page=<%= currentPage + 1 %>" class="bg-gray-800 text-gray-300 px-4 py-2 rounded-md hover:bg-gray-700 transition">Next</a>
          <% } %>
        </div>
      </div>
    </main>
  </div>
 
  <script>
    const menuBtn = document.getElementById("menuBtn");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    menuBtn?.addEventListener("click", () => {
      sidebar.classList.toggle("-translate-x-full");
      overlay.classList.toggle("hidden");
    });

    overlay?.addEventListener("click", () => {
      sidebar.classList.add("-translate-x-full");
      overlay.classList.add("hidden");
    });



async function openOrderModal(orderId) {
  const modal = document.getElementById("orderModal");
  const content = document.getElementById("orderModalContent");
  modal.classList.remove("hidden");
  modal.classList.add("flex");

  try {
    const res = await fetch(`/admin/orders/${orderId}`);
    const data = await res.json();

    if (data.success) {
      const order = data.order;
      content.innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Product List -->
          <div class="col-span-2 bg-zinc-950 rounded-xl border border-gray-700 p-5">
            <div class="flex justify-between bg-gray-800 px-4 py-2 rounded-md mb-3 font-semibold">
              <span>Product</span><span>Qty</span><span>Price</span>
            </div>
            ${order.items.map(item => `
              <div class="flex justify-between items-center border-t border-gray-700 py-3">
                <span>${item.productId?.name}</span>
                <span>${item.quantity}</span>
                <span>₹${item.price.toFixed(2)}</span>
              </div>
            `).join('')}
          </div>

          <!-- Order Update -->
          <div class="bg-zinc-950 rounded-xl border border-gray-700 p-5 space-y-4">
            <h3 class="bg-gray-800 text-center py-2 rounded-md font-semibold">Order Update</h3>
            <p>Ordered On : <span class="text-gray-300">${new Date(order.createdAt).toLocaleDateString()}</span></p>
            <p>Current State : <span class="text-yellow-400 font-semibold">${order.status}</span></p>
            <p>Payment : <span class="text-blue-400">${order.paymentMethod}</span></p>
            <p>Total : <span class="text-green-400 font-semibold">₹${order.grandTotal}</span></p>
          </div>
        </div>

        <!-- Customer Details -->
        <div class="bg-zinc-950 rounded-xl border border-gray-700 p-5 mt-6">
          <h3 class="bg-gray-800 text-center py-2 rounded-md font-semibold mb-4">Customer Details</h3>
          <div class="space-y-2 text-sm">
            <p><span class="font-semibold">Customer Name :</span> ${order.userId?.name}</p>
            <p><span class="font-semibold">Mobile Number :</span> ${order.userId?.mobile}</p>
            <p><span class="font-semibold">Type of Payment :</span> ${order.paymentMethod}</p>
            <p><span class="font-semibold">Address :</span> ${order.address?.addressLine}, ${order.address?.pincode}, ${order.address?.district}</p>
          </div>
        </div>
      `;
    } else {
      content.innerHTML = `<p class="text-red-500">Order details not found.</p>`;
    }
  } catch (err) {
    console.error(err);
    content.innerHTML = `<p class="text-red-500">Error loading order details.</p>`;
  }
}

function closeOrderModal() {
  const modal = document.getElementById("orderModal");
  modal.classList.add("hidden");
  modal.classList.remove("flex");
}
</script>



  <!-- Google Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</body>
</html>
