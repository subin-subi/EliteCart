<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | Coupons</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-gray-900 text-white flex">



  <!-- Sidebar -->
  <%- include('../partials/sidebar', { path: '/admin/coupon' }) %>

  <!-- Main Content -->
  <main class="flex-1 ml-64 p-6">
    <!-- Header -->
<div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-8 bg-gray-900 p-4 rounded-xl shadow-lg">
  <!-- Left: Page Title -->
  <h1 class="text-2xl sm:text-3xl font-bold text-white tracking-wide text-center sm:text-left">
    üéüÔ∏è Coupons
  </h1>

  <!-- Center: Add Coupon Button -->
  <button
    onclick="openAddCouponModal()"
    class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 sm:px-8 py-2.5 sm:py-3 rounded-xl 
    font-semibold text-base sm:text-lg hover:scale-105 transition-all duration-200 shadow-md w-full sm:w-auto">
    + Add Coupon
  </button>


<!-- Right: Search Bar -->
<div class="relative w-full sm:w-80">
  <form method="GET" action="/admin/coupon" class="relative">
    <input
      type="text"
      name="search"
      value="<%= typeof search !== 'undefined' ? search : '' %>"
      placeholder="Search Coupons..."
      class="w-full pr-10 pl-4 py-2.5 border border-gray-700 rounded-xl 
             focus:outline-none focus:ring-2 focus:ring-blue-500 
             bg-gray-800 text-white placeholder-gray-400"
    />
    <button type="submit"
      class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-blue-400">
      <i class="fas fa-search text-lg"></i>
    </button>
  </form>
</div>


</div>


    <!-- Coupons Table -->
    <div class="bg-[#0b0b0b] border border-gray-700 rounded-2xl p-4">
      <% if (coupons && coupons.length > 0) { %>
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="border-b border-gray-700 text-gray-300 text-base font-semibold">
              <th class="py-3 px-4">Coupon Code</th>
              <th class="py-3 px-4">Discount (%)</th>
              <th class="py-3 px-4">Start Date</th>
              <th class="py-3 px-4">Expiry Date</th>
              <th class="py-3 px-4">Max Amount</th>
              <th class="py-3 px-4">Min Amount</th>
              <th class="py-3 px-4 text-center">Actions</th>
            </tr>
          </thead>
        <tbody>
  <% coupons.forEach(coupon => { %>
    <tr class="border-b border-gray-800 hover:bg-gray-900 transition">
      <td class="py-3 px-4"><%= coupon.code %></td>

      <td class="py-3 px-4">
  <% if (coupon.discountType === 'percentage') { %>
    <%= coupon.discountValue %>%
  <% } else { %>
    ‚Çπ<%= coupon.discountValue %>
  <% } %>
</td>


      <td class="py-3 px-4"><%= coupon.startDate.toLocaleDateString() %></td>
      <td class="py-3 px-4"><%= coupon.expiryDate.toLocaleDateString() %></td>
      <td class="py-3 px-4">‚Çπ<%= coupon.maxDiscountAmount %></td>
      <td class="py-3 px-4">‚Çπ<%= coupon.minPurchaseAmount %></td>

      <td class="py-3 px-4 flex justify-center space-x-2">
        <% if (coupon.isActive === false) { %>
          <!-- Show deleted message -->
          <span class="text-red-500 font-semibold text-sm">Coupon Deleted</span>
        <% } else { %>
          <!-- Show action buttons -->
          <button 
  class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded-lg text-sm font-medium"
  onclick='openEditCouponModal(<%- JSON.stringify(coupon) %>)'>
  Edit
</button>

          <button
            class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg text-sm font-medium"
            onclick="deleteCoupon('<%= coupon._id %>')"
          >
            Delete
          </button>
        <% } %>
      </td>
    </tr>
  <% }) %>
</tbody>

        </table>
      <% } else { %>
        <p class="text-center text-gray-400 py-6">No coupons found.</p>
      <% } %>

      

 
    </div>


<!-- ///////////////////////////////////////pagination///////////////////////////////////////////////////// -->

<!-- Pagination -->
<div class="flex justify-center items-center space-x-2 mt-6">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>" 
       class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600">
       Prev
    </a>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <a href="?page=<%= i %>" 
       class="px-4 py-2 rounded-lg 
       <%= i === currentPage ? 'bg-blue-600 text-white' : 'bg-gray-800 text-gray-300 hover:bg-gray-700' %>">
       <%= i %>
    </a>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>" 
       class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600">
       Next
    </a>
  <% } %>
</div>



  </main>

<!-- ///////////////////// Coupon Adding Modal  //////////////////// -->
<div id="addCouponModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center hidden z-50">
  <div class="bg-[#0b0b0b] text-white w-full max-w-3xl rounded-2xl shadow-xl border border-gray-700 p-6 relative">

    <!-- Close Button -->
    <button type="button" onclick="closeAddCouponModal()" 
            class="absolute top-3 right-3 text-gray-400 hover:text-white text-2xl font-bold">
      &times;
    </button>

    <!-- Modal Header -->
    <h2 class="text-2xl font-bold mb-6 text-center text-white">Add New Coupon</h2>

    <!-- Form -->
    <form id="addCouponForm" class="grid grid-cols-2 gap-6">
      
      <!-- Coupon Code -->
<div>
  <label class="block mb-2 text-sm text-gray-400">Coupon Code</label>
  <div class="flex gap-2">
    <input 
      type="text" 
      id="couponCode" 
      name="code" 
      placeholder="Enter or generate coupon code"
      class="flex-1 px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"
    >
    <button 
      type="button"
      onclick="generateCouponCode()"
      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition duration-200"
    >
      Generate
    </button>
  </div>
  <span id="codeError" class="text-red-500 text-xs mt-1 block"></span>
</div>

<!-- Min Amount -->
<div>
  <label class="block mb-2 text-sm text-gray-400">Min Amount</label>
  <input type="number" id="minAmount" name="minAmount" placeholder="Enter min amount"
        class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
  <span id="minAmountError" class="text-red-500 text-xs mt-1 block"></span>
</div>

<!-- Start Date -->
<div class="relative mb-4">
  <label class="block mb-2 text-sm text-gray-400">Start Date</label>
  <input
    id="startDate"
    name="startDate"
    type="text"
    placeholder="Select start date"
    class="w-full pl-10 pr-4 py-2 bg-black border border-gray-600 rounded-lg 
          focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"
  />
  <i class="fa-regular fa-calendar-days absolute left-3 top-10 text-gray-400 cursor-pointer"></i>
  <span id="startDateError" class="text-red-500 text-xs mt-1 block"></span>
</div>



<!-- Max Amount -->
<div>
  <label class="block mb-2 text-sm text-gray-400">Max Amount</label>
  <input type="number" id="maxAmount" name="maxAmount" placeholder="Enter max amount"
        class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
  <span id="maxAmountError" class="text-red-500 text-xs mt-1 block"></span>
</div>



<!-- Expiry Date -->
<div class="relative">
  <label class="block mb-2 text-sm text-gray-400">Expiry Date</label>
  <input
    id="expiryDate"
    name="expiryDate" 
    type="text"
    placeholder="Select expiry date"
    class="w-full pl-10 pr-4 py-2 bg-black border border-gray-600 rounded-lg 
          focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"
  />
  <i class="fa-regular fa-calendar-days absolute left-3 top-10 text-gray-400 cursor-pointer"></i>
  <span id="expiryDateError" class="text-red-500 text-xs mt-1 block"></span>
</div>


  <!-- discount type -->
<div> 
  <label class="block mb-2 text-sm text-gray-400">Discount Type</label>
   <select id="discountType" 
   name="discountType" 
   class="w-full px-3 py-2 bg-black border
    border-gray-600 rounded-lg focus:outline-none focus:ring-2
     focus:ring-blue-500 text-white"
      onchange="toggleDiscountInput()" >
       <option value="">Select Type</option> 
       <option value="percentage">Percentage</option>
        <option value="flat">Flat</option> </select> </div>

<!-- Discount Value -->
  <div
   id="discountValueContainer" class="hidden mt-4"> 
    <label id="discountLabel" class="block mb-2 text-sm text-gray-400">Discount Value</label>
   <input type="number" 
   id="discountValue"
    name="discount" 
    placeholder="Enter discount value"
     class="w-full px-3 py-2 bg-black border
      border-gray-600 rounded-lg focus:outline-none focus:ring-2
       focus:ring-blue-500 text-white" >
       </div>



<!-- Description -->
<div class="col-span-2">
  <label class="block mb-2 text-sm text-gray-400">Coupon Description</label>
  <textarea id="description" name="description" placeholder="Enter coupon description"
            class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"></textarea>
  <span id="descriptionError" class="text-red-500 text-xs mt-1 block"></span>
</div>


      <!-- Submit Button -->
      <div class="col-span-2 flex justify-end space-x-4">
        <button type="button" onclick="closeAddCouponModal()"
                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-semibold transition">
          Cancel
        </button>
        <button type="submit"
                class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-2 rounded-lg font-semibold hover:scale-105 transition-all duration-200">
          Add Coupon
        </button>
      </div>
    </form>
  </div>
</div>


<!-- /////////////////////////////editing modal/////////////////////////////////////////////// -->

<div id="editCouponModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center hidden z-50">
  <div class="bg-[#0b0b0b] text-white w-full max-w-3xl rounded-2xl shadow-xl border border-gray-700 p-6 relative">

    <!-- Close Button -->
    <button type="button" onclick="closeEditCouponModal()" 
            class="absolute top-3 right-3 text-gray-400 hover:text-white text-2xl font-bold">
      &times;
    </button>

    <!-- Modal Header -->
    <h2 class="text-2xl font-bold mb-6 text-center text-white">Edit Coupon</h2>

    <!-- Form -->
    <form id="editCouponForm" class="grid grid-cols-2 gap-6">

      <!-- Hidden ID -->
      <input type="hidden" id="editCouponId" name="couponId">

      <!-- Coupon Code -->
      <div>
        <label class="block mb-2 text-sm text-gray-400">Coupon Code</label>
        <input 
          type="text"
          id="editCouponCode"
          name="code"
          placeholder="Enter coupon code"
          class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"
        >
        <span id="editCodeError" class="text-red-500 text-xs mt-1 block"></span>
      </div>

      <!-- Min Amount -->
      <div>
        <label class="block mb-2 text-sm text-gray-400">Min Amount</label>
        <input type="number" id="editMinAmount" name="minAmount" placeholder="Enter min amount"
              class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
        <span id="editMinAmountError" class="text-red-500 text-xs mt-1 block"></span>
      </div>


     
<!-- Start Date -->
<div class="relative mb-4">
  <label class="block mb-2 text-sm text-gray-400">Start Date</label>
  <input
    id="editStartDate"
    name="startDate"
    type="date"
    class="w-full pl-10 pr-4 py-2 bg-black border border-gray-600 rounded-lg
           focus:outline-none focus:ring-2 focus:ring-blue-500 text-white cursor-pointer"
  />
  <i
    class="fa-regular fa-calendar-days absolute left-3 top-10 text-gray-400 cursor-pointer"
    onclick="document.getElementById('editStartDate').showPicker()"
  ></i>
  <span id="editStartDateError" class="text-red-500 text-xs mt-1 block"></span>
</div>


      <!-- Max Amount -->
      <div>
        <label class="block mb-2 text-sm text-gray-400">Max Amount</label>
        <input type="number" id="editMaxAmount" name="maxAmount" placeholder="Enter max amount"
              class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
        <span id="editMaxAmountError" class="text-red-500 text-xs mt-1 block"></span>
      </div>

      


<!-- Expiry Date -->
<div class="relative">
  <label class="block mb-2 text-sm text-gray-400">Expiry Date</label>
  <input
    id="editExpiryDate"
    name="expiryDate"
    type="date"
    class="w-full pl-10 pr-4 py-2 bg-black border border-gray-600 rounded-lg
           focus:outline-none focus:ring-2 focus:ring-blue-500 text-white cursor-pointer"
  />
  <i
    class="fa-regular fa-calendar-days absolute left-3 top-10 text-gray-400 cursor-pointer"
    onclick="document.getElementById('editExpiryDate').showPicker()"
  ></i>
  <span id="editExpiryDateError" class="text-red-500 text-xs mt-1 block"></span>
</div>

      <!-- Discount Type -->
      <div>
        <label class="block mb-2 text-sm text-gray-400">Discount Type</label>
        <select id="editDiscountType" name="discountType"
          class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"
          onchange="toggleEditDiscountInput()">
          <option value="">Select Type</option>
          <option value="percentage">Percentage</option>
          <option value="flat">Flat</option>
        </select>
      </div>

      <!-- Discount Value -->
      <div id="editDiscountValueContainer">
        <label class="block mb-2 text-sm text-gray-400">Discount Value</label>
        <input type="number" id="editDiscountValue" name="discount"
              class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"
              placeholder="Enter discount value">
      </div>

      <!-- Description -->
      <div class="col-span-2">
        <label class="block mb-2 text-sm text-gray-400">Coupon Description</label>
        <textarea id="editDescription" name="description" placeholder="Enter description"
                  class="w-full px-3 py-2 bg-black border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white"></textarea>
        <span id="editDescriptionError" class="text-red-500 text-xs mt-1 block"></span>
      </div>

      <!-- Buttons -->
      <div class="col-span-2 flex justify-end space-x-4">
        <button type="button" onclick="closeEditCouponModal()"
                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-semibold transition">
          Cancel
        </button>
        <button type="submit"
                class="bg-gradient-to-r from-green-500 to-teal-600 text-white px-6 py-2 rounded-lg font-semibold hover:scale-105 transition-all duration-200">
          Update Coupon
        </button>
      </div>
    </form>
  </div>
</div>



<!-- /////////////////////////////////////////////////////////////////////////////////////////////////////// -->

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="/javascript/admin/coupen.js"></script>

<!-- Flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  flatpickr("#startDate", { dateFormat: "Y-m-d", minDate: "today" });
  flatpickr("#expiryDate", { dateFormat: "Y-m-d", minDate: "today" });
</script>

 <!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
  flatpickr("#startDate", {
    dateFormat: "Y-m-d",
    minDate: "today"
  });

  flatpickr("#expiryDate", {
    dateFormat: "Y-m-d",
    minDate: "today"
  });

  flatpickr("#editStartDate", {
    dateFormat: "Y-m-d",
    minDate: "today"
  });
  flatpickr("#editExpiryDate", {
    dateFormat: "Y-m-d",
    minDate: "today"
  });
</script>


</body>
</html>
