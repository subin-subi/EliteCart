<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management | Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Joan&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <%- include('../partials/sidebar', { path: '/admin/products' }) %>
        
        <!-- Main Content -->
        <div class="flex-1 ml-64 p-8">
            <!-- Header Section -->
            <div class="mb-6">
                <h1 class="text-3xl font-bold text-gray-800">Product Management</h1>
                <p class="text-gray-600 mt-1">Manage product inventory and status</p>
            </div>

<!-- Search and Filter Section -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
  <form id="searchFilterForm" method="GET" action="/admin/products">
    <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0">

      <!-- Search Input + Clear Button -->
      <div class="relative flex-1">
        <input 
          type="text" 
          name="search"
          value="<%= typeof search !== 'undefined' ? search : '' %>"
          placeholder="Search products..."
          id="searchProduct"
          autocomplete="off"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg 
                 focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10
                 text-sm md:text-base"
        >

        <!-- Clear Button -->
        <button 
          type="button" 
          id="clearSearchBtn"
          class="absolute right-3 top-1/2 transform -translate-y-1/2 
                 text-gray-500 hover:bg-gray-200 rounded-full w-6 h-6 flex items-center 
                 justify-center text-xs transition hidden"
        >
          ✕
        </button>
      </div>

      <!-- Search Button -->
      <button type="submit"
              class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 
                     transition flex items-center justify-center text-sm md:text-base">
        <span class="material-icons mr-2 text-sm md:text-base">search</span>
        Search
      </button>

      <!-- Status Dropdown -->
      <select 
  name="isBlocked" 
  class="px-4 py-2 border border-gray-300 rounded-lg 
         focus:ring-2 focus:ring-blue-500 focus:border-transparent
         text-sm md:text-base w-full md:w-auto"
>
  <option value="">All Status</option>
  <option value="false" <%= isBlocked === 'false' ? 'selected' : '' %>>Active</option>
  <option value="true"  <%= isBlocked === 'true'  ? 'selected' : '' %>>Blocked</option>
</select>


      <!-- Add Product Button -->
     <a href="/admin/addProduct" 
   class="mt-3 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition text-sm">
  Add Product
</a>

    </div>
  </form>
</div>



   <!-- Products Table -->
<div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex justify-between items-center">
            <h2 class="text-lg font-semibold text-gray-800">Product List</h2>
            <div class="text-sm text-gray-600">
                <% if (pagination) { %>
                    Showing <%= ((pagination.currentPage - 1) * 10) + 1 %> - <%= Math.min(pagination.currentPage * 10, pagination.totalProducts) %> of <%= pagination.totalProducts %> products
                <% } else { %>
                    No products available
                <% } %>
            </div>
        </div>
    </div>
    
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IMAGE</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PRODUCT NAME</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">CATEGORY</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">BRAND</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">VOLUME</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PRICE</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">STOCK</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">BLOCKED</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ACTIONS</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            <% if (products && products.length > 0) { %>
                <% products.forEach((product, index) => { %>
                    <tr class="hover:bg-gray-50 transition">
                        <!-- Image -->
                                                    <!-- Image -->
                        <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex-shrink-0 h-16 w-16">
                            <% if (product.variants.length > 0 && product.variants[0].mainImage) { %>
                            <img class="h-16 w-16 rounded-lg object-cover" 
                                src="<%= product.variants[0].mainImage %>" 
                                alt="<%= product.name %>">
                            <% } else { %>
                            <div class="h-16 w-16 rounded-lg bg-gray-200 flex items-center justify-center">
                                <span class="material-icons text-gray-400 text-2xl">image</span>
                            </div>
                            <% } %>
                        </div>
                        </td>


                        <!-- Name -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900"><%= product.name %></div>
                          
                        </td>

                        <!-- Category -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">
                                <%= product.category ? product.category.name : 'N/A' %>
                            </div>
                        </td>

                        <!-- Brand -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">
                                <%= product.brand ? product.brand.name : 'N/A' %>
                            </div>
                        </td>

                                                 <!-- Volume -->
                                       <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900">
                                          <%= product.variants.length > 0 ? product.variants[0].volume + ' ml' : 'N/A' %>
                                                </div>
                                            </td>

                                                            <!-- Price -->
                                            <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">
                                                ₹<%= product.variants.length > 0 ? product.variants[0].price : 'N/A' %>
                                            </div>
                                            </td>

                                            <!-- Stock -->
                                            <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">
                                                <%= product.variants.length > 0 ? product.variants[0].stock : 'N/A' %>
                                            </div>
                                            </td>

                                                                                 
                                                 <!-- Blocked -->
                                                                    <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full <%= product.isBlocked ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800' %>">
                                <%= product.isBlocked ? 'blocked' : 'active' %>
                            </span>
                        </td>

                        <!-- Actions -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center space-x-2">
                              <a href="/admin/editProduct/<%= product._id %>" 
                                      class="text-blue-500 hover:text-blue-700 hover:underline text-sm">
                                     Edit
                                    </a>
                                <button onclick="confirmToggleBlock('<%= product._id %>', <%= !!product.isBlocked %>)" 
                                        class="text-red-500 hover:text-red-700 hover:underline text-sm">
                                    <%= product.isBlocked ? 'Unblock' : 'Block' %>
                                </button>
                              

                            </div>
                        </td>
                    </tr>
                <% }); %>
            <% } else { %>
            <tr>
  <td colspan="8" class="px-6 py-12 text-center">
    <div class="flex flex-col items-center">
      <span class="material-icons text-gray-400 text-4xl mb-2">inventory_2</span>

      <% if (search || (status && status !== 'All Status')) { %>
        <p class="text-gray-500 text-lg">No products found</p>
        <p class="text-gray-400 text-sm mt-1">Try adjusting your search criteria or filters</p>
        <button onclick="clearFilters()" 
                class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm">
          Clear Filters
        </button>

      <% } else if (pagination && pagination.totalProducts === 0) { %>
        <p class="text-gray-500 text-lg">No products available</p>
        <p class="text-gray-400 text-sm mt-1">Add your first product to get started</p>
        <a href="/admin/addProduct" 
           class="mt-3 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition text-sm">
          Add First Product
        </a>

      <% } else { %>
        <p class="text-gray-500 text-lg">No products found</p>
        <p class="text-gray-400 text-sm mt-1">Add your first product to get started</p>
        <a href="/admin/addProduct" 
           class="mt-3 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition text-sm">
          Add Product
        </a>
      <% } %>
    </div>
  </td>
</tr>

            <% } %>
        </tbody>
    </table>
</div>
</div>
<!-- ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
        <!-- Pagination Info -->
        <% if (pagination) { %>
        <div class="bg-white px-6 py-3 border-t border-gray-200">
            <div class="text-center text-sm text-gray-600">
                Page <%= pagination.currentPage %> of <%= pagination.totalPages %> 
                (<%= pagination.totalProducts %> total products)
            </div>
        </div>
        <% } %>
        
        <!-- Pagination -->
        <% if (pagination && pagination.totalPages > 1) { %>
        <div class="bg-white px-6 py-4 border-t border-gray-200">
            <div class="flex items-center justify-between">
                <!-- Previous Button -->
                <% if (pagination.hasPrevPage) { %>
                <a href="/admin/products?page=<%= pagination.prevPage %><%= search ? '&search=' + encodeURIComponent(search) : '' %><%= status && status !== 'All Status' ? '&status=' + encodeURIComponent(status) : '' %>"
                   class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-100 hover:text-gray-700 transition">
                    <span class="material-icons text-sm mr-1">chevron_left</span>
                    Previous
                </a>
                <% } else { %>
                <button disabled class="px-3 py-2 text-sm font-medium text-gray-300 bg-gray-100 border border-gray-200 rounded-md cursor-not-allowed">
                    <span class="material-icons text-sm mr-1">chevron_left</span>
                    Previous
                </button>
                <% } %>

                <!-- Page Numbers -->
                <div class="flex items-center space-x-1">
                    <% 
                    const startPage = Math.max(1, pagination.currentPage - 2);
                    const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
                    
                    // Show first page if not in range
                    if (startPage > 1) { %>
                        <a href="/admin/products?page=1<%= search ? '&search=' + encodeURIComponent(search) : '' %><%= status && status !== 'All Status' ? '&status=' + encodeURIComponent(status) : '' %>"
                           class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-100 hover:text-gray-700 transition">
                            1
                        </a>
                        <% if (startPage > 2) { %>
                            <span class="px-2 py-2 text-sm text-gray-400">...</span>
                        <% } %>
                    <% } %>
                    
                    <% for (let i = startPage; i <= endPage; i++) { %>
                        <% if (i === pagination.currentPage) { %>
                            <span class="px-3 py-2 text-sm font-medium text-white bg-blue-600 border border-blue-600 rounded-md">
                                <%= i %>
                            </span>
                        <% } else { %>
                            <a href="/admin/products?page=<%= i %><%= search ? '&search=' + encodeURIComponent(search) : '' %><%= status && status !== 'All Status' ? '&status=' + encodeURIComponent(status) : '' %>"
                               class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-100 hover:text-gray-700 transition">
                                <%= i %>
                            </a>
                        <% } %>
                    <% } %>
                    
                    <% if (endPage < pagination.totalPages) { %>
                        <% if (endPage < pagination.totalPages - 1) { %>
                            <span class="px-2 py-2 text-sm text-gray-400">...</span>
                        <% } %>
                        <a href="/admin/products?page=<%= pagination.totalPages %><%= search ? '&search=' + encodeURIComponent(search) : '' %><%= status && status !== 'All Status' ? '&status=' + encodeURIComponent(status) : '' %>"
                           class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-100 hover:text-gray-700 transition">
                            <%= pagination.totalPages %>
                        </a>
                    <% } %>
                </div>

                <!-- Next Button -->
                <% if (pagination.hasNextPage) { %>
                <a href="/admin/products?page=<%= pagination.nextPage %><%= search ? '&search=' + encodeURIComponent(search) : '' %><%= status && status !== 'All Status' ? '&status=' + encodeURIComponent(status) : '' %>"
                   class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-100 hover:text-gray-700 transition">
                    Next
                    <span class="material-icons text-sm ml-1">chevron_right</span>
                </a>
                <% } else { %>
                <button disabled class="px-3 py-2 text-sm font-medium text-gray-300 bg-gray-100 border border-gray-200 rounded-md cursor-not-allowed">
                    Next
                    <span class="material-icons text-sm ml-1">chevron_right</span>
                </button>
                <% } %>
            </div>
        </div>
        <% } %>
    </div>
    </div>

<!-- ////////////////////////////////////////////////////////Crop Modal ///////////////////////////////////////////////////////////////// -->
   
     
  <div id="cropModal" class="fixed inset-0 bg-black bg-opacity-80 items-center justify-center hidden z-50">
    <div class="bg-gray-900 p-6 rounded-2xl max-w-xl w-full border border-gray-800">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-white">Crop Image</h2>
        <button onclick="closeCropModal()" class="text-gray-400 hover:text-white text-2xl font-bold transition-colors">&times;</button>
      </div>
      <div class="w-full h-96">
        <img id="cropImage" class="max-h-full w-full object-contain" />
      </div>
      <div class="text-center mt-4">
        <button onclick="cropAndSave()" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-xl hover:from-blue-600 hover:to-purple-600 transition-all duration-300">Crop & Save</button>
      </div>
    </div>
  </div>



 
    <script src="/javascript/admin/product.js"></script>
   
    
    
     
</body>
</html>

